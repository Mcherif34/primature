<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="template/layout">
<head>
	<title></title>
</head>
<body ng-controller="matriculationController" th:attr="ng-init='init();'">
<div layout:fragment="search">
		<form class="form-inline" role="search">
			<input type="text" class="form-control b-a rounded px-3 form-control-sm" style="min-width: 250px;" ng-model="dto.search.key" placeholder="Rechercher immatriculation" />
			<a href="#" ng-click="searchMatriculation()" class="btn success p-x-md" style="border-radius: 20px; padding-top: 3px; padding-bottom: 5px; margin-left: 10px; margin-right: 20px;"><i class="fa fa-search"></i></a>
		</form>
</div>
	
<div layout:fragment="content" class="page-content">
<!-- ############ PAGE START-->
<div class="p-a white lt box-shadow">
	<div class="row">
		<div class="col-sm-6">
			<h4 class="mb-0 _300">Gestion des imatriculations</h4>
			<small class="text-muted">Gestion des immatriculations</small>
		</div>
	</div>
</div>
<!-- ############ PAGE START-->
<div class="padding">
  <div class="row">
    <div class="col-md-12">
    	<div class="box">
			<div class="box-header">
				<div style="float:left; margin-top: 3px;">
					<h2 class="mb-0 _300">Liste des immatriculations</h2>
				    <small class="text-muted"><a style="font-size: 13px !important;" th:href="@{/}"><span class="nav-link-breadcrumb label">Tableau de bord</span></a> <span class="nav-link-breadcrumb label primary">Immatriculations</span></small>
				</div>
				<ul class="button_actions">
					<li><a href="#" ng-click="advancedSearchMatriculationForm()" class="btn btn-fw success" style="background: #666666; min-width: 1rem; padding-left: 13px; padding-right: 13px;"><i class="fa fa-search"></i></a></li>
					<!-- <li><a href="#" ng-click="addMatriculation()" class="btn btn-fw success"><i class="fa fa-plus"></i> &nbsp;<span>Nouveau</span></a></li> -->
					<li><a href="#" ng-click="importMatriculations()" class="btn btn-fw success"><i class="fa fa-upload"></i> &nbsp;<span>Importer</span></a></li>
					<li><a href="#" ng-click="" class="btn btn-fw orange"><i class="fa fa-download"></i> &nbsp;<span>Télécharger</span></a></li>
				</ul>
			</div>
			<div class="table-responsive">
				<table id="matriculationTable" ng-controller="matriculationTableController"
					th:attr="ng-init='init();'" class="table table-striped b-t b-b">
					<thead>
				    	<tr>
				        	<th>ID</th>
				            <th>Code véhicule</th>
				            <th>Immatricule</th>
				            <th>Modèle véhicule</th>
				            <th>Date immatriculation</th>
				            <th>Actions</th>
				        </tr>
				    </thead>
				</table>
			</div>
		</div>
    </div>
  </div>
  <!-- .modal -->
  <div id="matriculationModal" class="modal fade" data-backdrop="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
      	  <h5 class="modal-title" ng-if="addMatriculationForm">Enregistrement d'une immatriculation</h5>
      	  <h5 class="modal-title" ng-if="editMatriculationForm">Modification d'une immatriculation</h5>
        </div>
        <form id="matriculationForm" name="matriculationForm" method="post" action="#" class="form-horizontal" ui-jp="parsley">
          <div class="modal-body p-lg">
            <div class="row">
			  <input type="hidden" ng-model="dto.id" />
			  <div ng-class="'col-md-12'">
			  	<p class="text-muted">Renseignez les champs obligatoires</p>
			  	<div ng-if="matriculationRequiredError" class="alert alert-danger" role="alert">
			  	  Veuillez remplir tous les champs obligatoires !
			  	</div>
			  	<div ng-if="matriculationTechnicalError" class="alert alert-danger" role="alert">
			  	  Un problème est survenu ! Merci de contacter votre administrateur.
			  	</div>
			  	<div ng-if="matriculationSuccess" class="alert alert-success" role="alert">
			  	  L'opération s'est effectuée avec succès !
			  	</div>
			  </div>
			  <div ng-class="'col-md-4'">
            	<div class="form-group">
              	  <label><span class="asterik"> * </span> Code</label>
                  <input type="text" class="form-control" name="name" ng-model="dto.code" required="required" />                        
                </div>
			  </div>
			  <div ng-class="'col-md-4'">
            	<div class="form-group">
              	  <label><span class="asterik"> * </span> KY</label>
                  <input type="text" class="form-control" name="ky" ng-model="dto.ky" required="required" />                        
                </div>
			  </div>
			  <div ng-class="'col-md-4'">
            	<div class="form-group">
              	  <label>Avenant</label>
                  <input type="text" class="form-control" name="name" ng-model="dto.avenant" />                        
                </div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Immatriculation</label> <input
						type="text" class="form-control" name="matriculation" ng-model="dto.matriculation" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Modèle</label> <input
						type="text" class="form-control" name="model" ng-model="dto.model" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Client</label>
					<select class="form-control" name="clientId" ng-model="dto.clientId" ng-options="c.id as c.companyName for c in clients"></select>
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Date de début</label> <input
						type="text" class="form-control" name="startDate" datepicker="datepicker"
						ng-model="dto.startDate" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Date de fin prévisionnelle</label> <input
						type="text" class="form-control" name="endDate" datepicker="datepicker"
						ng-model="dto.endDate" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Date de fin réelle</label> <input
						type="text" class="form-control" name="effectiveEndDate" datepicker="datepicker"
						ng-model="dto.effectiveEndDate" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Type</label>
					<select class="form-control" name="matriculationTypeId" ng-model="dto.matriculationTypeId" ng-options="c.id as c.name for c in matriculationTypes"></select>
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Status</label>
					<select class="form-control" name="matriculationStatusId" ng-model="dto.matriculationStatusId" ng-options="c.id as c.name for c in matriculationStatus"></select>
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Commercial</label> <input
						type="text" class="form-control" name="commercial" ng-model="dto.commercial" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Montant TTC</label> <input
						type="text" class="form-control" name="amountTtc" ng-model="dto.amountTtc" />
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Méthode de paiement</label>
					<select class="form-control" name="paymentMethodId" ng-model="dto.paymentMethodId" ng-options="p.id as p.name for p in paymentMethods"></select>
				</div>
			  </div>
			  <div ng-class="'col-md-4'">
				<div class="form-group">
					<label>Echéance</label> <input
						type="text" class="form-control" name="paymentDue" ng-model="dto.paymentDue" />
				</div>
			  </div>
			</div>
          </div>
          <div class="modal-footer">
          	<a href="#" class="btn warn p-x-md" data-dismiss="modal">Annuler</a>
			<a href="#" ng-click="savematriculation()" class="btn success p-x-md">Enregistrer</a>
          </div>
        </form>
      </div><!-- /.modal-content -->
    </div>
  </div>
  <div id="importMatriculationsModal" class="modal" data-backdrop="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Importation des immatriculations</h5>
							<img ng-show="importing" style="float: left; max-height: 20px;" th:src="@{/resources/images/loading.gif}" />
						</div>
						<form id="importMatriculationsForm" name="importMatriculationsForm" method="post" action="#"
							class="form-horizontal" ui-jp="parsley">
							<div class="modal-body p-lg">
					            <div class="row">
								  <input type="hidden" ng-model="dto.id" />
								  <div ng-class="'col-md-12'">
								  	<p class="text-muted">Renseignez les champs obligatoires</p>
								  	<div ng-if="matriculationRequiredError" class="alert alert-danger" role="alert">
								  	  Veuillez remplir tous les champs obligatoires !
								  	</div>
								  	<div ng-if="matriculationTechnicalError" class="alert alert-danger" role="alert">
								  	  Un problème est survenu ! Merci de contacter votre administrateur.
								  	</div>
								  	<div ng-if="matriculationFileTypeError" class="alert alert-danger" role="alert">
								  	  Le format du fichier est invalide ! Merci de vérifier.
								  	</div>
								  	<div ng-if="matriculationSuccess" class="alert alert-success" role="alert">
								  	  L'opération s'est effectuée avec succès !
								  	</div>
								  </div>
								  <div ng-class="'col-md-12'">
								  	<div class="form-group">
					                  <label><span class="asterik"> * </span> Importer</label>
					                  <input type="file" class="form-control" id="matriculationFileInput" onchange="loadImportMatriculations()" />                        
					                </div>
								  </div>
								</div>
					          </div>
							<div class="modal-footer">
								<a href="#" class="btn warn p-x-md" data-dismiss="modal">Annuler</a>
								<a href="#" ng-click="saveImportMatriculations()" class="btn success p-x-md" ng-disabled="buttonDisabled">Enregistrer</a>
							</div>
						</form>
					</div>
					<!-- /.modal-content -->
				</div>
			</div>
			<div id="advancedSearchMatriculationModal" class="modal fade" data-backdrop="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Recherche avancée</h5>
						</div>
						<form method="post" ng-submit="advancedSearchMatriculation()" class="form-horizontal" ui-jp="parsley">
							<div class="modal-body p-lg">
								<div class="row">
									<div ng-class="'col-md-12'">
										<div style="font-weight: normal; background: #ffe9b9; padding: 6px; margin-bottom: 6px;">Immatriculations</div>
									</div>
									<div ng-class="'col-md-12'">
										<div class="form-group">
									    	<label>Code</label>
									        <input type="text" class="form-control" name="code" ng-model="dto.search.code" />
									    </div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
											<label>Date entre</label> <input
												type="text" class="form-control" name="dateStart"
												ng-model="dto.search.dateStart" datepicker="datepicker" />
										</div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
											<label>ET</label> <input
												type="text" class="form-control" name="dateEnd"
												ng-model="dto.search.dateEnd" datepicker="datepicker" />
										</div>
									</div>
								</div>
								<div class="row">
									<div ng-class="'col-md-12'">
										<div style="font-weight: normal; background: #ffe9b9; padding: 6px; margin-bottom: 6px;">Véhicules</div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
									    	<label>Code</label>
									        <select class="form-control" name="vehicleCode" ng-model="dto.search.vehicleCode" ng-options="v.id as v.code for v in vehicles">
									        	<option value="">Choisir une option</option>
									        </select>
									    </div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
									    	<label>Modèle</label>
									        <select class="form-control" name="vehicleModel" ng-model="dto.search.vehicleModel" ng-options="v.id as v.model for v in vehicles">
									        	<option value="">Choisir une option</option>
									        </select>
									    </div>
									</div>
									<div ng-class="'col-md-12'">
										<div class="form-group">
									    	<label>Série</label>
									        <input type="text" class="form-control" name="serie" ng-model="dto.search.serie" />
									    </div>
									</div>
								</div>
								<div class="row">
									<div ng-class="'col-md-12'">
										<div style="font-weight: normal; background: #ffe9b9; padding: 6px; margin-bottom: 6px;">Entreprises</div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
									    	<label>Société propriétaire</label>
									        <select class="form-control" name="ownerCompanyId" ng-model="dto.search.ownerCompanyId" ng-options="c.id as c.name for c in companies">
									        	<option value="">Choisir une option</option>
									        </select>
									    </div>
									</div>
									<div ng-class="'col-md-6'">
										<div class="form-group">
									    	<label>Société juridique</label>
									        <select class="form-control" name="legalCompanyId" ng-model="dto.search.legalCompanyId" ng-options="c.id as c.name for c in companies">
									        	<option value="">Choisir une option</option>
									        </select>
									    </div>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<a href="#" ng-click="advancedSearchMatriculation()" class="btn success p-x-md">Rechercher</a>
								<input type="reset" class="btn warn p-x-md" value="Annuler" />
							</div>
						</form>
					</div>
					<!-- /.modal-content -->
				</div>
			</div>
			<div id="matriculationDetailModal" class="modal fade" data-backdrop="true">
				<div class="modal-dialog modal-lg modal-customized">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Immatriculation Nº {{matriculationDetail.code}}</h5>
						</div>
						<div class="modal-body p-lg">
							<div class="row">
								<div ng-class="'col-md-3'">
									<div class="form-group">
										KY :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										{{matriculationDetail.ky}}
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										Date :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										{{matriculationDetail.date}}
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										Nº serie :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										{{matriculationDetail.serie}}
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										Modèle :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										<strong>{{matriculationDetail.vehicleModel}}</strong>
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										Société propriétaire :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										{{matriculationDetail.ownerCompanyName}}
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										Société juridique :
									</div>
								</div>
								<div ng-class="'col-md-3'">
									<div class="form-group">
										{{matriculationDetail.legalCompanyName}}
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<a href="#" class="btn danger p-x-md" data-dismiss="modal">Fermer</a>
						</div>
					</div>
				</div>
			</div>
  <!-- / .modal -->
  </div>
</div>
<div layout:fragment="plugins" class="page-content">
	<script th:src='@{/resources/js/client/matriculation.js}'></script>
</div>
</body>
</html>